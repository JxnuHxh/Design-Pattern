# 设计模式之代理模式  
设计模式来源于生活，每一种设计模式在现实世界中都能有与它相关的处理方式，     
关于代理模式，我们听到的见到的最多的可能就是静态代理、动态代理之类的，  
代理模式的定义:代理模式（Proxy），为其他对象提供一种代理以控制对这个对象的访问。   
  UML结构图如下：  
![](https://images2018.cnblogs.com/blog/1018770/201805/1018770-20180528192533385-636552287.png)      
# 代理模式的应用    
代理模式（Proxy）为另一个对象提供一个替身或占位符以控制对这个对象的访 问，简而言之就是用一个对象来代表另一个对象。

## 静态代理    
编译时执行就创建好代理类  
![](https://img2018.cnblogs.com/blog/1018770/201905/1018770-20190522161703546-1340227960.png)  
在代理类中注入依赖，即引入需要代理的实体类，通过代理类来调用实体类中的方法来实现静态代理。   
静态代理由我们自己去生成固定的代码进行编译。需要定义接口或抽象的父类作为抽象目标类，   
具体目标类和代理类一起实现相同的接口或继承相同的类，然后通过调用相同的方法来调用目标对象的方法。   
静态代理需要目标对象和代理对象实现相同的接口。可以在不修改目标对象功能的前提下，对目标功能进行扩展。   
虽然静态代理可以很好的对目标对象进行功能扩展，但对每一个服务都需要建立代理类，工作量较大且不易管理，    
而且如果接口发生改变的话，代理类也得进行相应的修改，这时动态代理的作用就显现出来了。    
优点：业务类只需要关注逻辑本身，保证了业务类的重用性。这是代理的共有优点   
缺点：1.代理对象的一个借口只服务一种类型的对象，如果要代理的方法很多，  
就要为每一种方法苏进行代理，静态代理在程序规模大是就无法胜任   
2.如果接口增加一个方法，除了所有实现类需要实现这个方法外，所有代理类也    
 需要实现此方法。增加了代码维护的复杂度      
## 动态代理   
运行时执行来创建代理类   
![](https://img2018.cnblogs.com/blog/1018770/201905/1018770-20190522164932446-109963697.png)   
动态代理与静态代理的区别在于：在程序运行时，动态代理类是运用反射机制创建而成的。   
在抽象工厂模式的最后有提到用反射来代理switch语句进行选择，这里就运用到了类似的思想。   
通过动态代理，我们不再需要手动创建代理类，只需编写一个动态处理器即可，而真正的代理对象    
由JDK在运行时帮我们创建。所以我们也将之称为JDK动态代理。    

优点：最大的好处是接口中声明的所有方法都被转移到调用处理器一个集中的方法中处理（invocation Handler.invoke）。   
这样，在接口方法数量比较多的时候，可以进行灵活处理，而不需要想静态代理那样每一个方法进行中转。  
缺点：始终无法摆脱仅支持interface代理的局限    
相比于静态代理，动态代理的优势很明显的，不仅减少了对业务接口的依赖，还降低了耦合度，   
但它还是无法摆脱对接口的依赖  
   
### 使用场景  
远程代理。为一个对象在不同的地址空间提供局部代表   
虚拟代理。根据需要创建开销很大的对象，通过它来存放实例化需要很长时间的真实对象   
安全代理。用来控制真实对象访问时的权限   
智能指引，当调用真实的对象时，代理处理另外一些事    
###  应用场景      
### 1.游戏代练   

![](https://images2018.cnblogs.com/blog/1018770/201805/1018770-20180528200529814-1440466262.png)   
游戏代练应该都听说过，许多人肯定也找过代练，曾经DNF、LOL、王者荣耀等等游戏的代练很多，   
当然现在各类游戏层出不穷，也都有各种代练，那这里所谓的代练是什么？就是Proxy，也即代理类，   
那游戏代练这件事就是一个代理模式。如果觉得不好理解可以这么想，代练的流程是，你把自己的账号交给代练人员，   
让他们帮你打怪升级，而你只需要提供账号即可。那代练人员那边，他所要做的就是登陆你的账号，   
然后替你打游戏，从第三者的角度来看，你这个角色在打怪升级，但这个第三者并不知道是不是你本人在打游戏，   
他只能看到你这个账号正在打怪升级，但并不需要知道后面打游戏的是谁。这就是代理模式，由他人代理玩游戏。

#### 2.邀请明星，联系其经纪人   
我们现在要邀请明星来上节目，我是直接给这个明星打电话吗？当然不是，是给他的经纪人打电话，    
然后再由经纪人通知到该明星，这里经纪人充当的就是代理的角色。   
#### 3.Windows快捷方式   
更常见的例子就是Windows的快捷方式，通过快捷方式，我们可以访问某个文件夹下的exe文件，     
这就是一个典型的代理模式，它将接口，按上面游戏的说法说就是代练的账号，提供了出来，     
我们只需点击快捷方式，它会帮我们运行指定目录下的指定程序。   
#### 4.火车票代售点   
#### 5.Spring AOP     
注意代理模式与适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口   
代理模式与装饰模式区别：装饰模式是为了增强功能，而代理模式是为了加以控制   


2013 年 6 月 13 日，阿里巴巴在支付宝的基础上推出了 “余额宝”这一项业务。这一举措掀起金融业内对互联网金 融的热烈讨论。以“余额宝”为代表的互联网金融对银行业 的理财产品发起了挑战。因此，本文着重对余额宝进行深入 的分析并把余额宝和商业银行的理财产品两者进行优劣对 比，分析这种金融创新带给传统银行业的冲击以及银行业的 未来对策。 一、国内外互联网金融的发展现状 （一）国外互联网金融的发展情况 国外互联网金融起步时间比我们早，方式也多样化。但 是因为本文着重以余额宝为例，因此我们着重分析国外与余 额宝类似的互联网金融方式。 PayPal 是国际上知名的网上交易工具，通称国际宝贝，是 针对具有国际收付款需求用户设计的账户，类似于我们国内 使用的支付宝。PayPal 公司于 1999 年设立了账户余额的货币 市场基金，该基金由 PayPal 自己的资产管理公司通过联接基 金的方式交给巴克莱的母账户管理，用户只需简单地进行设 置，存放在 PayPal 支付账户中不计利息的余额就将自动转入 货币基金市场，从而获得收益。PayPal 货币市场基金的规模在 2007 年达到巅峰 10 亿美元。PayPal 运作货币基金的主要目的 是为客户提供理财便利、吸引更多的沉淀资金、提高客户黏性， 与支付宝极为相似。 （二）国内互联网金融发展状况 根据中国互联网络信息中心 (CNNIC) 在京发布《第 33 次

中国互联网络发展状况统计报告》，截至 2013 年 12 月，我国 网民规模达 6.18 亿，在农村的普及速度超越城市。手机网民 规模达 5 亿，占总网民数的 81.0%。随着未来 4G 网络以及 无线网络的普及，这一数字会成倍增长。中国各家商业银行 的网上银行客户总数已经超过 6.5 亿，电子银行的交易替代 率均超过 60%，成为银行提供金融服务重要渠道之一。从上 述数据可以看出，我国的“网络军团”正急速膨胀，未来对 互联网金融的需求量将会越来越多。一些金融机构抓住这一 机会，纷纷在网上“开拓”自己的“新战场”。 同时，互联网金融存在的风险是不可忽视的，也是限制 网络金融普及的原因之一。针对此种情况，我国开始陆续出 台一些管理的法律规范，旨在保护金融参与者的权益和规范 网络金融的发展。2010 年，中央银行出台了《非金融机构支 付服务管理办法》，将第三方支付机构纳入监管范围。随后， 中央银行于 2011 年下发《第三方支付设备管理办法》规定 ： 客户沉淀在支付宝中的余额，支付宝有权利购买协议存款， 所获得的收益归支付宝所有。2013 年 6 月，中央银行再次发 布《支付机构客户备付金管理办法》旨在进一步对沉淀于支 付平台的资金进行严格的监管和控制。6 月 13 日，阿里巴巴 推出了“余额宝”的业务收益率比银行活期存款利率高十几倍， 瞬间吸引了无数中国网民。 二、余额宝产生原因及运作模式 “余额宝”是将基金公司的基金直销系统内置于支付宝 账户管理系统，资金在支付宝与余额宝之间转移相当于购买

和赎回基金。余额宝收益为用户购买货币基金的收益，余额 宝沉淀资金由基金公司进行管理，基金公司将筹集的这一部 分资金投入到货币基金的投资中。由于募集到的资金数量大， 所获得的收益比散户分散投资要多，基金公司将这些收益中 的部分收益与用户和第三方平台提供者分享。支付宝的起点 最少 1 元，大大降低了理财投资的准入门槛，因此在成立后 很短时间内就得到迅速发展。 （一）急需解决第三方平台沉淀资金的问题 沉淀资金又称作“客户备付金”，指支付机构为办理客 户委托的支付业务而实际收到的预收待付货币资金（杨国明、 李宝华，2006）。第三方支付机构在收款人和付款人之间设立 过渡账户，使收支款项在支付平台上实现可控性停顿，在双 方确立交易关系后可以直接转移资金去向。这种支付模式带 来的必然后果就是资金沉淀。沉淀资金按其来源的不同分为 在途资金和支付平台所吸存的资金。支付平台吸存资金充值 后的资金由于还没有使用而停留在支付平台的账户上，就产 生了第二种资金沉淀。 支付平台的资金流动性很大，甚至每时每刻都有资金被 支取或转走。但是由于互联网的特点，每天都会有大量的资 金对其进行补充，因此还是有大量的资金沉淀生在支付宝的 备用金账户上，这样就产生了数量可观的孽息。2011 年，《支 付机构客户备付金存管暂行办法（征求意见稿）》的颁布规定 沉淀资金所产生的利息除必须计提 10% 的风险准备金以外， 剩余的九成可全部归属第三方支付机构所有。 沉淀资金的价值取决于存放时间和投资回报，通常市场 利率越高，资金沉淀时间越长，沉淀资金价值就越高，但是 又有短期流动性，一笔固定的沉淀资金一般只能用于短期投 资。而余额宝的出现应对了沉淀资金所产生的问题。支付宝 通过和天弘基金的合作，把用户账户上“闲置”的钱“盘活” 起来。把散户的资金集中到一起后进行货币基金的投资。当 资金带来投资收益后把这些收益划出一部分给支付平台和支 付宝用户。余额宝的使用者能体验到小额理财的收益 ；支付 平台解决了被人诟病的沉淀资金的孽息问题并能大大减少备 付金日均余额的比例不得低于 10% 的规定所产生的影响 ；基 金公司则得到很好的发展，在一定程度上，余额宝的推出带 来一个三赢的局面。 （二）增加用户“黏性” 2013 年 6 月 13 日余额宝正式面世。6 月 30 日当天，余 额宝的有效基金户数为 251.56 万户，资金规模达到 66.01 亿 元。截至 2013 年 12 月 31 日，余额宝用户数为 4303 万，户 均持有额为 4307 元，累计发放收益为 17.9 亿元。
